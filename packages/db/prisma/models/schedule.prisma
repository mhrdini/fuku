// --------------------------------
// Reference models
// --------------------------------
model Location {
  id      String  @id @default(uuid())
  name    String  @unique
  address String?

  teamId           String            @map("team_id")
  team             Team              @relation(fields: [teamId], references: [id])
  shiftAssignments ShiftAssignment[]
  color            String            @default("#000000")

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  deletedById String?   @map("deleted_by_id")

  @@map("location")
}

model ShiftType {
  id               String            @id @default(uuid())
  name             String            @unique
  description      String?
  startTime        String            @map("start_time") // in 24-hr, zero-padded "HH:MM" format (e.g., "09:00") 
  endTime          String            @map("end_time") // same format as startTime
  shiftAssignments ShiftAssignment[]
  color            String            @default("#000000")
  teamId           String            @map("team_id")
  team             Team              @relation(fields: [teamId], references: [id])

  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @default(now()) @updatedAt @map("updated_at")
  deletedAt   DateTime? @map("deleted_at")
  deletedById String?   @map("deleted_by_id")

  @@map("shift_type")
}

// --------------------------------
// Assignment models
// --------------------------------

model DayAssignment {
  id   String   @id @default(uuid())
  date DateTime

  teamMemberId String     @map("team_member_id")
  teamMember   TeamMember @relation(fields: [teamMemberId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  shiftAssignment ShiftAssignment? @relation("DayAssignmentToShift")
  leaveAssignment LeaveAssignment? @relation("DayAssignmentToLeave")

  @@unique([teamMemberId, date])
  @@index([date])
  @@map("day_assignment")
}

model ShiftAssignment {
  id              String        @id @default(uuid())
  locationId      String        @map("location_id")
  shiftTypeId     String        @map("shift_type_id")
  location        Location      @relation(fields: [locationId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  shiftType       ShiftType     @relation(fields: [shiftTypeId], references: [id], onDelete: Restrict, onUpdate: Cascade)
  dayAssignmentId String        @unique @map("day_assignment_id")
  dayAssignment   DayAssignment @relation("DayAssignmentToShift", fields: [dayAssignmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  workHour        WorkHour?     @relation("ShiftAssignmentToWorkHour")

  @@index([locationId])
  @@index([shiftTypeId])
  @@index([locationId, shiftTypeId])
  @@map("shift_assignment")
}

model LeaveAssignment {
  id              String        @id @default(uuid())
  paid            Boolean
  dayAssignmentId String        @unique @map("day_assignment_id")
  dayAssignment   DayAssignment @relation("DayAssignmentToLeave", fields: [dayAssignmentId], references: [id], onDelete: Cascade, onUpdate: Cascade)

  @@map("leave_assignment")
}

// --------------------------------
// Scheduling constraint models
// --------------------------------

model Unavailability {
  id           String     @id @default(uuid())
  teamMemberId String     @map("team_member_id")
  teamMember   TeamMember @relation(fields: [teamMemberId], references: [id], onDelete: Cascade, onUpdate: Cascade)
  date         DateTime
  reason       String?

  @@unique([teamMemberId, date])
  @@index([teamMemberId])
  @@index([date])
  @@map("unavailability")
}
